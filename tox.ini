[tox]
envlist = lint,type
skipsdist = true
isolated_build = true

[testenv]
basepython = python3.12
setenv =
    PYTHONDONTWRITEBYTECODE = 1
    MYPY_CACHE_DIR = {toxworkdir}/.mypy_cache
    RUFF_CACHE_DIR = {toxworkdir}/.ruff_cache

[testenv:lint]
description = Check code style with ruff
deps = .[lint]
commands =
    ruff check tests/
    ruff format --check tests/

[testenv:type]
description = Check types with mypy
deps = .[type]
commands =
    mypy tests/

[testenv:test]
description = Run tests with pytest (requires PYTHON_IMAGE and CUDA_IMAGE env vars)
deps = .[test]
passenv =
    PYTHON_IMAGE
    CUDA_IMAGE
commands =
    pytest tests/ {posargs:-v}

[testenv:format]
description = Format code with ruff
deps = .[lint]
commands =
    ruff format tests/
    ruff check --fix tests/
